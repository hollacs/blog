import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
import { getDatabase, ref, update, increment, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

function _0x10c5d9(_0x19c8ba,_0x118efe,_0x58b0eb,_0x3ef9cd){return _0x3eff(_0x3ef9cd- -0xb7,_0x58b0eb);}(function(_0x4cb10b,_0x4023e6){function _0x1d4f98(_0x5ab594,_0x3acaa2,_0x340999,_0x24efeb){return _0x3eff(_0x5ab594-0x36a,_0x24efeb);}const _0x224a80=_0x4cb10b();function _0x21f992(_0x349e9e,_0x117533,_0x4b27f7,_0x5a4829){return _0x3eff(_0x5a4829- -0x21e,_0x4b27f7);}while(!![]){try{const _0x109dbe=parseInt(_0x1d4f98(0x451,0x462,0x471,0x46b))/(0x225d+-0x385*0xb+-0x1*-0x45b)*(-parseInt(_0x1d4f98(0x425,0x42d,0x41a,0x419))/(0x2260+-0x3b2+-0x1eac))+-parseInt(_0x21f992(-0x11d,-0x11a,-0x14f,-0x138))/(0x1*0x521+-0xa*-0x23b+-0x1b6c)+-parseInt(_0x1d4f98(0x44a,0x448,0x43c,0x44e))/(-0x163b+-0x1*0x5f9+0x1c38)*(-parseInt(_0x1d4f98(0x435,0x43e,0x42d,0x457))/(-0xb3b+-0x3*-0x9b7+-0x11e5))+parseInt(_0x21f992(-0x136,-0x11a,-0x148,-0x130))/(0xedb+-0x1797+-0x461*-0x2)+-parseInt(_0x21f992(-0x16a,-0x14d,-0x174,-0x157))/(-0x2535+0x94e+0x1bee)+-parseInt(_0x21f992(-0x149,-0x124,-0x137,-0x12c))/(-0x1b2c+0xae*-0xa+-0x110*-0x20)+parseInt(_0x21f992(-0x152,-0x15f,-0x12d,-0x148))/(-0xd60+0x1be*0x11+-0x1035);if(_0x109dbe===_0x4023e6)break;else _0x224a80['push'](_0x224a80['shift']());}catch(_0x1c3149){_0x224a80['push'](_0x224a80['shift']());}}}(_0x52b9,-0x641f9+0x46085+0xb5329));const _0x1f4a5d=(function(){const _0x2543e1={'SfSBA':function(_0x1d2534,_0x666d32){return _0x1d2534(_0x666d32);},'wrxTb':function(_0x35857d,_0x1e095f){return _0x35857d+_0x1e095f;},'JYYgX':'return\x20(fu'+'nction()\x20','QMkFU':function(_0x49c85a){return _0x49c85a();},'gdfaR':'miQrx'};let _0x5eb6f5=!![];return function(_0x3a68d3,_0x38a32b){const _0x29e0f3={'exVsB':function(_0x4f7b90,_0x490e90){function _0xcf1024(_0x32d5c8,_0x2b0473,_0x5705b9,_0x1c557a){return _0x3eff(_0x2b0473- -0x33d,_0x1c557a);}return _0x2543e1[_0xcf1024(-0x279,-0x262,-0x25a,-0x27d)](_0x4f7b90,_0x490e90);},'YzKZP':function(_0x475670,_0x47230d){function _0x702b69(_0x42a733,_0x1da7ed,_0x39b0fa,_0x469f6e){return _0x3eff(_0x1da7ed- -0x164,_0x39b0fa);}return _0x2543e1[_0x702b69(-0x6f,-0x91,-0xae,-0x7c)](_0x475670,_0x47230d);},'kVRcT':_0x2543e1[_0x3cbc80(-0x1b6,-0x185,-0x196,-0x1a2)],'qkdzI':_0x5609ac(0x62,0x79,0x75,0x56)+_0x3cbc80(-0x1ca,-0x1bc,-0x1d5,-0x1bd)+_0x5609ac(0x5c,0x51,0x62,0x66)+'\x20)','ssiQW':function(_0x142efb){return _0x2543e1['QMkFU'](_0x142efb);},'iANjj':_0x2543e1['gdfaR']},_0x534e39=_0x5eb6f5?function(){function _0x3ca757(_0x575232,_0x451d19,_0x40d862,_0x1e4bb0){return _0x3cbc80(_0x451d19,_0x451d19-0xdb,_0x40d862-0xe3,_0x575232-0xfc);}function _0xfbfa9c(_0x24fbd6,_0x163531,_0x57bf0f,_0x29102b){return _0x3cbc80(_0x29102b,_0x163531-0x34,_0x57bf0f-0x87,_0x57bf0f-0x2d0);}if(_0x38a32b){if(_0x29e0f3[_0x3ca757(-0x9c,-0x94,-0xaf,-0xac)]===_0x29e0f3['iANjj']){const _0x507806=_0x38a32b[_0xfbfa9c(0x131,0x11c,0x11d,0x10d)](_0x3a68d3,arguments);return _0x38a32b=null,_0x507806;}else{const _0x34df5a=_0x29e0f3[_0xfbfa9c(0x118,0x14a,0x13a,0x14a)](_0x5c0b6b,_0x29e0f3[_0xfbfa9c(0x126,0x13d,0x146,0x137)](_0x29e0f3['YzKZP'](_0x29e0f3[_0x3ca757(-0x8d,-0x72,-0x7b,-0x6b)],_0x29e0f3[_0x3ca757(-0xa9,-0xaa,-0xb7,-0xa0)]),');'));_0x35ed6b=_0x29e0f3[_0xfbfa9c(0x15b,0x139,0x139,0x141)](_0x34df5a);}}}:function(){};function _0x5609ac(_0x1dca94,_0x470ed2,_0x418042,_0x30f80a){return _0x3eff(_0x1dca94- -0x70,_0x470ed2);}function _0x3cbc80(_0x10f941,_0x224739,_0x51a792,_0x2c9999){return _0x3eff(_0x2c9999- -0x283,_0x10f941);}return _0x5eb6f5=![],_0x534e39;};}()),_0x5b17c4=_0x1f4a5d(this,function(){const _0x3adea3={};_0x3adea3['GGcia']=_0x416d59(-0xab,-0x9d,-0x9e,-0x90)+'+$';function _0x416d59(_0x3fe936,_0x51ef6f,_0x1fd4bd,_0x25705c){return _0x3eff(_0x51ef6f- -0x192,_0x25705c);}const _0x2a52c4=_0x3adea3;function _0x2e9215(_0x53c704,_0x64cda5,_0x5b8fbb,_0x20dfed){return _0x3eff(_0x53c704- -0x33a,_0x20dfed);}return _0x5b17c4[_0x2e9215(-0x246,-0x257,-0x268,-0x237)]()['search'](_0x2a52c4[_0x2e9215(-0x26d,-0x24d,-0x275,-0x268)])[_0x416d59(-0xb1,-0x9e,-0x9d,-0x7d)]()['constructo'+'r'](_0x5b17c4)['search'](_0x2a52c4[_0x2e9215(-0x26d,-0x256,-0x25e,-0x26b)]);});_0x5b17c4();function _0x3eff(_0x499b2b,_0x438027){const _0x2bcbd5=_0x52b9();return _0x3eff=function(_0x4d28e8,_0x5bb89d){_0x4d28e8=_0x4d28e8-(-0x7da*0x1+0x11df+-0x94e);let _0x2c9f29=_0x2bcbd5[_0x4d28e8];if(_0x3eff['VgWqwF']===undefined){var _0x3be0cf=function(_0x268432){const _0x889280='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1e1949='',_0x45d89b='',_0x37b56e=_0x1e1949+_0x3be0cf;for(let _0x4cc9c4=-0x2444+0x8*0x472+0xa*0x12,_0x1670cc,_0x106ffb,_0x4e27e3=0xc1e+0x2476+-0x3094;_0x106ffb=_0x268432['charAt'](_0x4e27e3++);~_0x106ffb&&(_0x1670cc=_0x4cc9c4%(-0x23b7+0x1687+0xd34)?_0x1670cc*(0x1*-0xfd4+0xeef*0x1+-0x1*-0x125)+_0x106ffb:_0x106ffb,_0x4cc9c4++%(0x23da+-0x1586+0x1ca*-0x8))?_0x1e1949+=_0x37b56e['charCodeAt'](_0x4e27e3+(0x9ca+-0xa*0x1d5+0x892))-(0xeec+-0x2084+0x11a2)!==0x2209*-0x1+-0x221d+0x4426?String['fromCharCode'](0x1f0d+-0x22ae+0x4a0&_0x1670cc>>(-(0x11f5+-0xe9b*-0x2+-0x2f29*0x1)*_0x4cc9c4&-0x128e+0x232d+0x1*-0x1099)):_0x4cc9c4:-0x259b+-0x5bd*0x4+0x3c8f){_0x106ffb=_0x889280['indexOf'](_0x106ffb);}for(let _0x20e408=-0x7c1+0x5*0x5d5+-0x1568,_0x2a8915=_0x1e1949['length'];_0x20e408<_0x2a8915;_0x20e408++){_0x45d89b+='%'+('00'+_0x1e1949['charCodeAt'](_0x20e408)['toString'](0x1690+-0x15af+-0x13*0xb))['slice'](-(0x1c*-0x64+0x8f9+0x1f9));}return decodeURIComponent(_0x45d89b);};_0x3eff['vrKVAX']=_0x3be0cf,_0x499b2b=arguments,_0x3eff['VgWqwF']=!![];}const _0x3ecf2f=_0x2bcbd5[-0xf0+-0x241*-0x11+-0x2561],_0x4d400=_0x4d28e8+_0x3ecf2f,_0x4927d3=_0x499b2b[_0x4d400];if(!_0x4927d3){const _0x4b863e=function(_0x369f6b){this['keQYXD']=_0x369f6b,this['IUbYSw']=[0x1ac*-0x4+-0x1d75+0x2426,0x25f*-0x4+0x6fb*-0x3+-0x1e6d*-0x1,-0x184a+-0x1b59*-0x1+-0x9*0x57],this['kPhzfj']=function(){return'newState';},this['nbjAnn']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['kODvJw']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4b863e['prototype']['XYHZxN']=function(){const _0x5d75d6=new RegExp(this['nbjAnn']+this['kODvJw']),_0x1083af=_0x5d75d6['test'](this['kPhzfj']['toString']())?--this['IUbYSw'][0x15*-0x9d+-0x1832+-0x54*-0x71]:--this['IUbYSw'][0x3*0xc8f+0x2482+0x1*-0x4a2f];return this['JgdrUc'](_0x1083af);},_0x4b863e['prototype']['JgdrUc']=function(_0x339794){if(!Boolean(~_0x339794))return _0x339794;return this['DetsmC'](this['keQYXD']);},_0x4b863e['prototype']['DetsmC']=function(_0x340e82){for(let _0x516fa4=0x1ebd+-0x21a+-0x1*0x1ca3,_0x49c0cc=this['IUbYSw']['length'];_0x516fa4<_0x49c0cc;_0x516fa4++){this['IUbYSw']['push'](Math['round'](Math['random']())),_0x49c0cc=this['IUbYSw']['length'];}return _0x340e82(this['IUbYSw'][-0x62+0xff*-0x1c+0x1c46]);},new _0x4b863e(_0x3eff)['XYHZxN'](),_0x2c9f29=_0x3eff['vrKVAX'](_0x2c9f29),_0x499b2b[_0x4d400]=_0x2c9f29;}else _0x2c9f29=_0x4927d3;return _0x2c9f29;},_0x3eff(_0x499b2b,_0x438027);}const _0x8ede04=(function(){let _0x3ed48c=!![];return function(_0x12a18f,_0x4e65ec){const _0x34cd67=_0x3ed48c?function(){function _0xc3cb13(_0x214958,_0x362b29,_0x19199f,_0x3fc01e){return _0x3eff(_0x362b29-0x21a,_0x19199f);}if(_0x4e65ec){const _0xaa002e=_0x4e65ec[_0xc3cb13(0x304,0x2ea,0x308,0x2e2)](_0x12a18f,arguments);return _0x4e65ec=null,_0xaa002e;}}:function(){};return _0x3ed48c=![],_0x34cd67;};}()),_0x1ef455=_0x8ede04(this,function(){const _0x205b01={'SSjWj':function(_0x413705,_0xd86e35){return _0x413705(_0xd86e35);},'xdnas':function(_0x3ed1b3,_0x152f72){return _0x3ed1b3+_0x152f72;},'UdWli':_0x18e6e2(-0x59,-0x44,-0x5d,-0x28)+_0x18e6e2(-0x5c,-0x48,-0x46,-0x35),'NBTQD':_0x58aee5(0x208,0x213,0x1f0,0x220)+_0x58aee5(0x1fc,0x21a,0x20f,0x217)+'rn\x20this\x22)('+'\x20)','vSlXn':function(_0x320f62){return _0x320f62();},'QSaOd':_0x58aee5(0x20a,0x22d,0x20c,0x228),'CTzIv':_0x18e6e2(-0x5b,-0x5a,-0x44,-0x4f),'Yfvbr':_0x18e6e2(-0x75,-0x5b,-0x6d,-0x49),'iqVsl':'exception','ePEuq':'table','EtcsY':_0x58aee5(0x1ee,0x1e5,0x204,0x1d6),'FIVlS':function(_0x571b4c,_0x11cc40){return _0x571b4c<_0x11cc40;}};let _0x464799;try{const _0xc5f268=_0x205b01['SSjWj'](Function,_0x205b01[_0x58aee5(0x21b,0x224,0x217,0x23d)](_0x205b01[_0x18e6e2(-0x9a,-0x77,-0x79,-0x70)]+_0x205b01['NBTQD'],');'));_0x464799=_0x205b01[_0x58aee5(0x1f8,0x215,0x1d7,0x212)](_0xc5f268);}catch(_0x15faa2){_0x464799=window;}const _0x404d6f=_0x464799[_0x58aee5(0x1fe,0x1df,0x221,0x1f1)]=_0x464799['console']||{},_0x42922f=[_0x205b01[_0x18e6e2(-0x75,-0x79,-0x6a,-0x90)],_0x205b01[_0x18e6e2(-0x6b,-0x7b,-0x59,-0x99)],_0x205b01[_0x58aee5(0x1f9,0x1db,0x1fd,0x1e6)],'error',_0x205b01[_0x58aee5(0x1f0,0x1fe,0x1dd,0x1e1)],_0x205b01['ePEuq'],_0x205b01[_0x18e6e2(-0x49,-0x5d,-0x7d,-0x43)]];function _0x58aee5(_0x28fc57,_0x331dce,_0x47cbb1,_0x2e26c0){return _0x3eff(_0x28fc57-0x136,_0x47cbb1);}function _0x18e6e2(_0x417ae3,_0x401398,_0x38e38d,_0xaa0e51){return _0x3eff(_0x401398- -0x137,_0x417ae3);}for(let _0x27c108=0x850+-0x1ac*0x4+-0x1a0;_0x205b01[_0x18e6e2(-0x73,-0x6d,-0x53,-0x6c)](_0x27c108,_0x42922f['length']);_0x27c108++){const _0x14dfb6=_0x8ede04['constructo'+'r'][_0x18e6e2(-0x37,-0x47,-0x53,-0x67)][_0x18e6e2(-0x34,-0x4d,-0x68,-0x3e)](_0x8ede04),_0xd41b34=_0x42922f[_0x27c108],_0xe839d7=_0x404d6f[_0xd41b34]||_0x14dfb6;_0x14dfb6[_0x18e6e2(-0x49,-0x58,-0x38,-0x38)]=_0x8ede04[_0x58aee5(0x220,0x211,0x216,0x20a)](_0x8ede04),_0x14dfb6['toString']=_0xe839d7[_0x58aee5(0x22a,0x23d,0x22b,0x221)][_0x58aee5(0x220,0x243,0x205,0x21e)](_0xe839d7),_0x404d6f[_0xd41b34]=_0x14dfb6;}});_0x1ef455();function _0x52b9(){const _0x2cf829=['tMrqCwrJtvfcDq','mwm4owiUzMLYzq','rxrJC1K','u2ztqKe','Aw5MBW','D2fYBG','CwTKEKK','x19WCM90B19F','mZa0mgTVAuHRAq','sLLzz1G','zwjHC2vPBY5JBW','DeLK','A2v0','EgrUyxm','mJaWmJq4ofvmB0Tbqq','mZy0mJjNBNnvtw8','zw5Kzxjjza','yMfZzwfWCc5JBW','yMLUza','AufoAMO','C3nPuvC','zxHwC0i','mtK3mJi3mK5qzgviCG','BMn0Aw9UkcKG','ChjVDg90ExbL','Ag9SBgfIBg9Nlq','nZm3ndm3nK55rwTNsa','CMv0DxjUicHMDq','Dg9tDhjPBMC','kcGOlISPkYKRkq','Ahr0Chm6lY9OBW','BwvHC3vYzw1LBG','mtO5mtGXmta5mG','wxPlwLa','A1zsy1q','rY1dwdbztKXena','Dc1YDgrIlMzPCG','oguZmtu3mJLMyq','DhjHy2u','D1HkA1DUweW5qG','AxfwC2W','mtHezwrlzeO','q1r6sxy','zgf0ywjHC2vvuG','uvnHt2q','ntiYnJaYzdGZzq','vwrxBgK','C3rVCMfNzuj1yW','DLnSwg4','wwz2yNi','BgXHyMXVzY0XyW','quL6yvn5qMK0vG','y3rVCIGICMv0Dq','mtqWndq1mNPeExbZsG','y29UC29Szq','mwm4owi','rKLwBfm','mtiWuuntwxPV','CM4GDgHPCYiPka','r0DJAwe','zs5HCha','mtiZoNDLyJPJoa','yxbWBhK','yxbWswq','E30Uy29UC3rYDq','D3j4vgi','Bg9N','vJjxsgT6Agjr','mJe1mdCZnZjeu1HXzvC','BwvZC2fNAw5NuW'];_0x52b9=function(){return _0x2cf829;};return _0x52b9();}const _0x166c85={};_0x166c85['apiKey']=_0x14bb78(0x339,0x351,0x356,0x351)+_0x10c5d9(0x25,0xd,0x1c,0x2)+_0x14bb78(0x377,0x356,0x369,0x376)+_0x10c5d9(0x1d,0x4,0x31,0x1e),_0x166c85['authDomain']=_0x14bb78(0x375,0x38b,0x382,0x3a4)+_0x10c5d9(0x2e,0x22,0x42,0x22)+_0x14bb78(0x381,0x377,0x37a,0x370)+'m',_0x166c85[_0x10c5d9(-0x18,0x1e,0x13,0x6)+'L']=_0x10c5d9(0x36,0x3e,0x56,0x3f)+_0x14bb78(0x33c,0x360,0x355,0x333)+'89b-defaul'+_0x14bb78(0x3ab,0x3ad,0x38d,0x39d)+_0x14bb78(0x396,0x354,0x373,0x36c)+'m',_0x166c85['projectId']=_0x14bb78(0x36a,0x38c,0x382,0x3a1)+_0x10c5d9(-0xa,0x2,0x10,0x12);function _0x14bb78(_0x39490d,_0x3044d9,_0x52c005,_0x2c5968){return _0x3eff(_0x52c005-0x291,_0x2c5968);}_0x166c85[_0x10c5d9(0x7,-0x14,0xe,0xa)+_0x14bb78(0x361,0x35d,0x375,0x38d)]='hollablog-'+_0x10c5d9(0x2,0x43,0x2f,0x22)+'basestorag'+_0x10c5d9(0x34,0x8,0x1b,0x17),_0x166c85[_0x14bb78(0x358,0x356,0x368,0x349)+_0x10c5d9(0x26,0x2b,0x2e,0x31)]='9181109212'+'3',_0x166c85[_0x10c5d9(0x1,0x0,0xc,0x1a)]=_0x14bb78(0x369,0x397,0x389,0x36f)+_0x14bb78(0x369,0x363,0x360,0x347)+_0x14bb78(0x340,0x344,0x348,0x349)+_0x14bb78(0x336,0x338,0x350,0x364),_0x166c85[_0x10c5d9(0x3b,0x60,0x22,0x40)+_0x14bb78(0x35e,0x35c,0x374,0x390)]=_0x14bb78(0x39f,0x392,0x38c,0x3a5)+'8M';const firebaseConfig=_0x166c85;

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Sign in anonymously and update view count
function incrementViewCount(postId) {
  signInAnonymously(auth)
    .then((userCredential) => {
      console.log('Anonymous sign-in successful:', userCredential.user.uid); // confirm
      const postRef = ref(db, `posts/${postId}`);
      return update(postRef, { viewCount: increment(1) })
        .then(() => console.log('View count updated successfully'))
        .catch((updateError) => console.error('Update failed:', updateError));
    })
    .catch((error) => {
      console.error('Anonymous sign-in failed:', error.code, error.message);
    });
}

// Display view count
function displayViewCount(postId) {
  const postRef = ref(db, `posts/${postId}/viewCount`);
  onValue(postRef, (snapshot) => {
    const viewCount = snapshot.val() || 0;
    document.getElementById('view-count').textContent = viewCount;
  }, { onlyOnce: true });
}

// Prevent duplicate counting
function trackView(postId) {
  const viewedKey = `viewed_${postId}`;
  if (!localStorage.getItem(viewedKey)) {
    incrementViewCount(postId);
    localStorage.setItem(viewedKey, 'true');
  }
  displayViewCount(postId);
}

export { trackView };